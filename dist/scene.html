<html>
    <!-- Entry point for scenecreator based applications -->
    <head>
        <script src="js/j4ts-0.2.0-SNAPSHOT/bundle.js"></script>
        <script src="js/env3d.js"></script>
        <script src="js/bundle.js"></script>
        <script type="text/javascript">
         
         function Game() {
             
             var ENV = new env3d.Env(false);
             
             var client = new XMLHttpRequest();
             client.open('GET', 'world.txt');
             client.onreadystatechange = function(state) {
                 if (client.readyState == 4) {
                     // parse the csv file
                     var lines = client.responseText.split('\n');
                     lines.forEach(function(line) {                     
                         console.log(line);
                         var tokens = line.split(',');
                         switch(tokens[0]) {
                             case 'skybox':
                                 ENV.setSky(tokens[1]);
                                 break;
                             case 'camera':
                                 
                                 ENV.cameraX = parseFloat(tokens[1]);
                                 ENV.cameraY = parseFloat(tokens[2]);
                                 ENV.cameraZ = parseFloat(tokens[3]);
                                 
                                 ENV.cameraPitch = parseFloat(tokens[5]);
                                 ENV.cameraYaw = parseFloat(tokens[4]);
                                 break;
                             case 'terrain':
                                 ENV.setTerrain(tokens[3]);
                                 break;
                             case 'object':
                                 var objClass = tokens[10];
                                 console.log("Creating GameObject of class "+objClass);
                                 //var gameObject = eval('new '+objClass+'()');                                 
                                 var gameObject = new window[objClass](
                                     parseFloat(tokens[1]),
                                     parseFloat(tokens[2]),
                                     parseFloat(tokens[3])
                                 );
                                 console.log(gameObject);
                                 gameObject.scale = tokens[4];

                                 gameObject.rotateX = parseFloat(tokens[5]);
                                 gameObject.rotateY = parseFloat(tokens[6]);
                                 gameObject.rotateZ = parseFloat(tokens[7]);

                                 gameObject.model = tokens[8];
                                 gameObject.texture = tokens[9];

                                 ENV.addObject(gameObject);

                             default:
                                 //console.warn('unable to parse line',line);
                         }
                     });
                 }
             } 
             client.send();

             ENV.start();
             this.play = function() {
                 ENV.gameObjects.forEach(function(obj) {
                     obj.move();
                 });
             }

             ENV.loop = this.play;
             
         }
         

         window.addEventListener("load", function() {
             var game = new Game();
             
         });
         
        </script>
        <style>
         body {
             margin: 0;
             padding: 0;
         }
        </style>
    </head>
    <body>
        <div id="env3d"></div>
    </body>
</html>
